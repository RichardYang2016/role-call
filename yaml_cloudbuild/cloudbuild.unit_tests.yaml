steps:

# Trigger unit tests for the backend.
- id: backend_unit_tests
  name: 'gcr.io/cloud-builders/mvn'
  args: ['clean', 'test']
  dir: "backend"

# Trigger coverage tests for the backend.
- id: backend_coverage_report
  name: 'gcr.io/cloud-builders/mvn'
  args: ['jacoco:report']
  dir: "backend"

# Upload generated coverage tests data.
- id: upload_coverage_data
  name: 'gcr.io/cloud-builders/builder'
  entrypoint: bash
  args: ['-c', 'bash <(curl -s https://codecov.io/bash) -X gcov -X coveragepy -X fix']
  env:
    - 'VCS_COMMIT_ID=$COMMIT_SHA'
    - 'VCS_BRANCH_NAME=$BRANCH_NAME'
    - 'VCS_PULL_REQUEST=$_PR_NUMBER'
    - 'CI_BUILD_ID=$BUILD_ID'
    - 'CODECOV_TOKEN=$_CODECOV_TOKEN'  
